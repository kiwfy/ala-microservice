<?php

namespace App\Domains\{{domainCaps}}\Businesses;

use App\Domains\{{domainCaps}}\Repositories\{{domainCaps}}DeadDetailRepository;
use App\Exceptions\Custom\DataNotFoundException;
use Mockery;
use PHPUnit\Framework\TestCase;

class {{domainCaps}}DeadDetailBusinessTest extends TestCase
{
    /**
     * @covers \App\Domains\{{domainCaps}}\Businesses\{{domainCaps}}DeadDetailBusiness::__construct
     */
    public function testCreateBusiness()
    {
        ${{domain}}DeadDetailRepositoryMock = Mockery::mock(
            {{domainCaps}}DeadDetailRepository::class
        )->shouldReceive('getTable')
            ->once()
            ->andReturn('test')
            ->shouldReceive('setTable')
            ->with('test_test')
            ->once()
            ->andReturn(true)
            ->getMock();

        $config = app()->make('config');
        $config->set('app.db_suffix', '_test');

        ${{domain}}DeadDetailBusiness = new {{domainCaps}}DeadDetailBusiness(
            ${{domain}}DeadDetailRepositoryMock
        );

        $this->assertInstanceOf(
            {{domainCaps}}DeadDetailBusiness::class,
            ${{domain}}DeadDetailBusiness
        );
    }

    /**
     * @covers \App\Domains\{{domainCaps}}\Businesses\{{domainCaps}}DeadDetailBusiness::process
     */
    public function testProcess()
    {
        $id = '01E4KKE1VK2P2FWYVGPTANVFMM';

        $data = [
            'field' => 'test',
        ];

        ${{domain}}DeadDetailRepositoryMock = Mockery::mock(
            {{domainCaps}}DeadDetailRepository::class
        )->shouldReceive('getDeadById')
            ->with($id)
            ->once()
            ->andReturn($data)
            ->shouldReceive('getTable')
            ->once()
            ->andReturn('test')
            ->shouldReceive('setTable')
            ->with('test_test')
            ->once()
            ->andReturn(true)
            ->getMock();

        $config = app()->make('config');
        $config->set('app.db_suffix', '_test');

        ${{domain}}DeadDetailBusiness = new {{domainCaps}}DeadDetailBusiness(
            ${{domain}}DeadDetailRepositoryMock
        );

        $process = ${{domain}}DeadDetailBusiness->process(
            $id
        );

        $this->assertEquals($data, $process);
    }

    /**
     * @covers \App\Domains\{{domainCaps}}\Businesses\{{domainCaps}}DeadDetailBusiness::process
     */
    public function testProcessAndNotFound()
    {
        $id = '01E4KKE1VK2P2FWYVGPTANVFMM';

        ${{domain}}DeadDetailRepositoryMock = Mockery::mock(
            {{domainCaps}}DeadDetailRepository::class
        )->shouldReceive('getDeadById')
            ->with($id)
            ->once()
            ->andReturn([])
            ->shouldReceive('getTable')
            ->once()
            ->andReturn('test')
            ->shouldReceive('setTable')
            ->with('test_test')
            ->once()
            ->andReturn(true)
            ->getMock();

        $config = app()->make('config');
        $config->set('app.db_suffix', '_test');

        ${{domain}}DeadDetailBusiness = new {{domainCaps}}DeadDetailBusiness(
            ${{domain}}DeadDetailRepositoryMock
        );

        $this->expectExceptionObject(
            new DataNotFoundException(
                'Data not found',
                404
            )
        );

        ${{domain}}DeadDetailBusiness->process($id);
    }

    protected function tearDown(): void
    {
        Mockery::close();
    }
}
